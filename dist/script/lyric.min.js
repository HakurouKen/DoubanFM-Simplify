var Lyric=function(a,b,c){var d=function(a,b,d){var e,f=function(){return c.get("http://sug.music.baidu.com/info/suggestion?format=json&version=2&from=0&word="+a.title+"-"+a.artist)},g=function(a){var b=JSON.parse(a),d=(b.data.song[0]||{}).songid;return d?c.ajax({url:"http://play.baidu.com/data/music/songlink",method:"post",data:{songIds:d},dataType:"json"}):c.Deferred().reject()},h=function(a){var b=a.data.songList[0].lrcLink;return b?(e="http://play.baidu.com"+b,c.get(e)):c.Deferred().reject()},i=function(a){for(var b,c,d=a.split("\n"),e=0,f=d.length,g=/^\[\d+:\d+(.\d+)\]/,h="",i=[];f>e;e++)g.test(d[e])&&(h=d[e].match(g)[0],b={},b.lrc=d[e].replace(h,""),c=0,h.replace(/[\[\]]/g,"").split(":").forEach(function(a){c=60*c+parseFloat(a,10)}),c=1e3*c,b.time=c,i.push(b));return i};return d=d||function(){},f().done(function(a){g(a).done(function(a){h(a).done(function(a){b(i(a),a,e)}).fail(d)}).fail(d)})},e=function(a,b){var e,f=[],g=b||c("body"),h=g.find("ul.lyrics"),i=g.find(".download-lrc"),j=[],k=0,l=!1,m="",n=function(a,b,d){for(var e=j.length,b=b||0,d=d||e-1,f=Math.floor((b+d)/2);d-b>0;)a>=j[f]?(b=f+1,f=Math.floor((b+d)/2)):(d=f,f=Math.floor((b+d)/2));return{startTime:function(){return j[b-1]},endTime:function(){return j[b]},lines:function(){return h.find("li.lrc")},thisLine:function(){return b-2>=0?this.lines().eq(b-2):c()},nextLine:function(){return this.lines().eq(b-1)},offset:function(){var b=0,d=this.thisLine(),e=this.nextLine(),f=d.prevAll(),g=0,i=d.height()||0,j=e.height()||0;return g+=d.height()/2,Array.prototype.forEach.call(f,function(a){g+=c(a).height()}),b=(i+j)/2*(a-this.startTime())/(this.endTime()-this.startTime()),b=isNaN(b)?h.height():b+g}}},o={initLrc:function(b,c){h.empty().css("margin-top","0px"),g.find(".lyric-wrapper").removeClass("none"),f=b||[],k=0;var d="";return f.length?(j=Array.prototype.map.call(f,function(a){return d+='<li class="lrc" time = '+a.time+">"+(a.lrc||"&nbsp;")+"</li>",a.time}),h.html(d)):g.find(".lyric-wrapper").addClass("none"),m=c||"",i.attr("link",m).attr("filename",e.title+"-"+e.artist),j.push(a.getLength()),j.unshift(0),this},getLrc:function(){return f},jumpTo:function(a){var b=400,c=n(1e3*a+b+k),d=c.offset();return h.css("margin-top","-"+d+"px"),c.lines().removeClass("on"),c.thisLine().addClass("on"),this},fix:function(a){k+=1e3*a},freeze:function(){l=!0},unfreeze:function(){l=!1}};return a.bind("loadstart",function(){e=a.getSongInfo(),o.freeze(),d(e,function(a,b,c){o.initLrc(a,c),o.unfreeze()},function(){o.initLrc()})}),a.bind("timeupdate",function(){!l&&o.jumpTo(a.getCurTime())}),o};return e}(window,document,jQuery);