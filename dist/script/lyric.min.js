var Lyric=function(a,b,c){var d=function(a,b,d){var e=function(){return c.get("http://sug.music.baidu.com/info/suggestion?format=json&version=2&from=0&word="+a.title+"-"+a.artist)},f=function(a){var b=JSON.parse(a),d=(b.data.song[0]||{}).songid;return d?c.ajax({url:"http://play.baidu.com/data/music/songlink",method:"post",data:{songIds:d},dataType:"json"}):c.Deferred().reject()},g=function(a){var b=a.data.songList[0].lrcLink;return b?c.get("http://play.baidu.com/"+b):c.Deferred().reject()},h=function(a){for(var b,c,d=a.split("\n"),e=0,f=d.length,g=/^\[\d+:\d+(.\d+)\]/,h="",i=[];f>e;e++)g.test(d[e])&&(h=d[e].match(g)[0],b={},b.lrc=d[e].replace(h,""),c=0,h.replace(/[\[\]]/g,"").split(":").forEach(function(a){c=60*c+parseFloat(a,10)}),c=1e3*c,b.time=c,i.push(b));return i};return d=d||function(){},e().done(function(a){f(a).done(function(a){g(a).done(function(a){b(h(a),a)}).fail(d)}).fail(d)})},e=function(a,b){var e=[],f=b||c("body"),g=f.find("ul.lyrics"),h=[],i=0,j=!1,k=function(a,b,d){for(var e=h.length,b=b||0,d=d||e-1,f=Math.floor((b+d)/2);d-b>0;)a>=h[f]?(b=f+1,f=Math.floor((b+d)/2)):(d=f,f=Math.floor((b+d)/2));return{startTime:function(){return h[b-1]},endTime:function(){return h[b]},lines:function(){return g.find("li.lrc")},thisLine:function(){return b-2>=0?this.lines().eq(b-2):c()},nextLine:function(){return this.lines().eq(b-1)},offset:function(){var b=0,d=this.thisLine(),e=this.nextLine(),f=d.prevAll(),h=0,i=d.height()||0,j=e.height()||0;return h+=d.height()/2,Array.prototype.forEach.call(f,function(a){h+=c(a).height()}),b=(i+j)/2*(a-this.startTime())/(this.endTime()-this.startTime()),b=isNaN(b)?g.height():b+h}}},l={initLrc:function(b){g.empty().css("margin-top","0px"),f.find(".lyric-wrapper").removeClass("none"),e=b||[],i=0;var c="";return e.length?(h=Array.prototype.map.call(e,function(a){return c+='<li class="lrc" time = '+a.time+">"+(a.lrc||"&nbsp;")+"</li>",a.time}),g.html(c)):f.find(".lyric-wrapper").addClass("none"),h.push(a.getLength()),h.unshift(0),this},getLrc:function(){return e},jumpTo:function(a){var b=400,c=k(1e3*a+b+i),d=c.offset();return g.css("margin-top","-"+d+"px"),c.lines().removeClass("on"),c.thisLine().addClass("on"),this},fix:function(a){i+=1e3*a},freeze:function(){j=!0},unfreeze:function(){j=!1}};return a.bind("loadstart",function(){var b=a.getSongInfo();l.freeze(),d(b,function(a){l.initLrc(a),l.unfreeze()},function(){l.initLrc()})}),a.bind("timeupdate",function(){!j&&l.jumpTo(a.getCurTime())}),l};return e}(window,document,jQuery);