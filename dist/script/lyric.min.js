var Lyric=function(a,b,c){var d=function(a,b){var d=[],e=b||c("body"),f=e.find("ul.lyrics"),g=[],h=0,i=function(a,b,d){for(var e=g.length,b=b||0,d=d||e-1,h=Math.floor((b+d)/2);d-b>0;)a>=g[h]?(b=h+1,h=Math.floor((b+d)/2)):(d=h,h=Math.floor((b+d)/2));return{startTime:function(){return g[b-1]},endTime:function(){return g[b]},lines:function(){return f.find("li.lrc")},thisLine:function(){return b-2>=0?this.lines().eq(b-2):c()},nextLine:function(){return this.lines().eq(b-1)},offset:function(){var b=0,d=this.thisLine(),e=this.nextLine(),g=d.prevAll(),h=0,i=d.height()||0,j=e.height()||0;return h+=d.height()/2,Array.prototype.forEach.call(g,function(a){h+=c(a).height()}),b=(i+j)/2*(a-this.startTime())/(this.endTime()-this.startTime()),b=isNaN(b)?f.height():b+h}}},j={initLrc:function(b){f.empty().css("margin-top","0px"),e.find(".lyric-wrapper").removeClass("none"),d=b||[],h=0;var c="";return d.length?(g=Array.prototype.map.call(d,function(a){return c+='<li class="lrc" time = '+a.time+">"+(a.lrc||"&nbsp;")+"</li>",a.time}),f.html(c)):e.find(".lyric-wrapper").addClass("none"),g.push(a.getLength()),g.unshift(0),this},getLrc:function(){return d},jumpTo:function(a){var b=400,c=i(1e3*a+b+h),d=c.offset();return f.css("margin-top","-"+d+"px"),c.lines().removeClass("on"),c.thisLine().addClass("on"),this},fix:function(a){h+=1e3*a}};return a.bind("loadstart",function(){var b=a.getSongInfo();c.ajax({type:"post",url:"http://dblrc.sinaapp.com/q",data:{song_name:b.title,artist:b.artist},beforeSend:function(){},success:function(a){var b=JSON.parse(a);b.length?j.initLrc(b):j.initLrc()},error:function(){j.initLrc()}})}),a.bind("timeupdate",function(){j.jumpTo(a.getCurTime())}),j};return d}(window,document,jQuery);