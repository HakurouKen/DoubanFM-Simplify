var Player=function(a,b,c,d){var e=function(a){function b(a){function b(a,b,c){var d="string"==typeof a?k.find(a):a;"text"===b?d.text(c):"html"===b?d.html(c):k.find(a).attr(b,c)}a&&(b("div.cover>img","src",a.picture.replace(/\/mpic\//,"/lpic/")),b(".cover","data-album","http://music.douban.com"+a.album),b(".infos .artist","text",a.artist),b(".infos .album-title","text","<"+a.albumtitle+">"),b(".infos .year","text",a.public_time),b(".infos .title-roller a","text",a.title),b(".infos .title-roller a","href","http://music.douban.com"+a.album))}var e,f,g,h,i,j,k=a?"string"==typeof a?c(a):a:c("body"),l=k.find(".player"),m=[],n={},o=new Audio,p=0;o.autoplay=!0;var q={initSong:function(a,c){return n=a,m.push(a),p++,o.src=a.url,b(a),c&&c(a),this},getState:function(){return e},getSongInfo:function(){return n},getCurTime:function(){return o.currentTime},getSongList:function(){return m},getNextSongList:function(a,b){c.ajax({url:"/j/mine/playlist",method:"GET",data:{type:a?a:"n",sid:n.sid,pt:Math.round(10*o.currentTime)/10,channel:c(".channel_list .channel.selected").data("cid")||0,pb:64,from:"mainsite",r:Math.round(0xffffffffff*Math.random()).toString(16)},success:function(a){"function"==typeof b&&b(a)}})},play:function(){return o.currentTime=0,o.play(),this},pause:function(){return o.pause(),this},resume:function(){return o.play(),this},prev:function(a){return p=--p>=0?p:0,this.initSong(m[p],a),this},heart:function(a){return this.getNextSongList(a?"r":"u"),this},end:function(){return this.getNextSongList("e"),k.find("a.btn.next").click(),this},trash:function(a){var b=this;return this.getNextSongList("b",function(c){b.initSong(c.song[0],a)}),this},next:function(a){var b=this;return this.getNextSongList("s",function(c){b.initSong(c.song[0],a)}),this},vol:function(a){return a!==d?(a=parseInt(a),a=a>100?100:0>a?0:a,o.volume=a/100,this):i},volUp:function(a){return this.vol(i+a),this},volDown:function(a){return this.vol(i-a),this},mute:function(){return this.vol(0),this},jumpTo:function(a){var b,c=[],d=0;return"number"==typeof a?d=a:"string"==typeof a&&("%"===a.substr(-1)?d=parseInt(a.slice(0,-1))*o.duration/100:(c=a.split(":"),b=c.length,c.forEach(function(a,c){d+=parseInt(a)*Math.pow(60,b-1-c)}))),"number"==typeof d&&(o.currentTime=parseInt(d)),this},loop:function(a){return a===d?j:(j=!!a,this)},bind:function(a,b){o.addEventListener(a,b)},once:function(a,b){o.addEventListener(a,function(c){b(c),this.removeEventListener(a,arguments.callee)})}};return o.addEventListener("loadstart",function(){e=o.paused?"paused":"playing",f=o.duration,h=o.currentTime/o.duration,i=100*o.volume,j=o.loop}),o.addEventListener("play",function(){e="playing"}),o.addEventListener("pause",function(){e="pause"}),o.addEventListener("durationchange",function(){f=o.duration}),o.addEventListener("progress",function(){var a=o.buffered.length?o.buffered.length-1:0;setTimeout(function(){g=o.buffered.end(a)/f},1e3)}),o.addEventListener("timeupdate",function(){h=o.currentTime/f}),o.addEventListener("volumechange",function(){i=100*o.volume}),o.addEventListener("ended",function(){j?q.play():q.end()}),o.addEventListener("progress",function(){o.buffered.length?o.buffered.length-1:0;k.find(".load-progress").width(l.width()*g)}),o.addEventListener("timeupdate",function(){var a=f-o.currentTime,b="-"+Math.floor(a/60)+":"+("0"+parseInt(a%60)).substr(-2);k.find(".controller .time").text(b),k.find(".play-progress").width(l.width()*h)}),q};return e}(window,document,jQuery);